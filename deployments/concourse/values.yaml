#@ load("@ytt:data", "data")
---
concourse:
  web:
    auth:
      mainTeam:
        localUser: #@ data.values.username
    externalUrl: https://ci.petewall.net
    kubernetes:
      createTeamNamespaces: false
    prometheus:
      enabled: true
  worker:
    #! Need to use containerd to avoid these issues: mounting "cgroup" to rootfs at "/sys/fs/cgroup" caused: invalid argument
    runtime: containerd

web:
  enabled: true
  ingress:
    enabled: true
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
    - ci.petewall.net
    ingressClassName: public
    tls:
    - hosts:
      - ci.petewall.net
      secretName: concourse-web-tls

worker:
  enabled: true
  replicas: 2

persistence:
  worker:
    storageClass: synology-nfs

postgresql:
  enabled: true
  auth:
    database: concourse
    username: #@ data.values.pgusername
    password: #@ data.values.pgpassword
    postgresPassword: #@ data.values.pgpassword
  primary:
    persistence:
      storageClass: synology-nfs

secrets:
  create: false
